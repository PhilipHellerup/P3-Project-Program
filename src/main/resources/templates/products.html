<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <!-- Static page title shown on the webpage -->
        <title>Produkter</title>
        <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png" />
        <link rel="shortcut icon" href="/images/favicon.png" />

        <!-- === Styles and Scripts === -->
        <!-- Bootstrap Styling -->
        <link rel="stylesheet" href="/css/bootstrap.css" />

        <!-- Custom Styling For Product & Service Button -->
        <link rel="stylesheet" href="/css/products.css" />

        <!-- Google Material Icons (used for delete and search icons) -->
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        />

        <!-- BootStrap Icon (used for modal Product & Service icons) -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

        <!-- Bootstrap JavaScript (for modals, dropdowns, etc.) -->
        <script type="module" src="/js/bootstrap.js"></script>

        <!-- Custom JS: Handles Fetch Errors in both "addProductsModal.js" and "productActions.js" -->
        <script type="module" src="/js/utils/fetchUtils.js"></script>

        <!-- Custom JS: Handles delete and edit functionality in the Product Table -->
        <script type="module" src="/js/productActions.js"></script>

        <!-- Custom JS: Handles delete and edit functionality in the Service Table -->
        <script type="module" src="/js/serviceActions.js"></script>

        <!-- Custom JS: Handles the 'Add Product' modal form behavior -->
        <script type="module" src="/js/modals/addProductsModal.js"></script>

        <!-- Custom JS: Pagination = Handles client-side page switching -->
        <script src="/js/productPagination.js"></script>
    </head>

    <body class="d-flex justify-content-center with-navbar content-push" style="background-color: #f5f5f5">
        <!-- === Navbar Section === -->
        <!-- Navigation bar dynamically injected at runtime via navbar.js -->
        <nav>
            <script src="/js/navbar.js"></script>
        </nav>

        <!-- === Main Page Container (No Nav Bar) === -->
        <div
            class="page-content-container w-95 d-flex flex-column m-5 p-4 border secondary-border-subtle rounded-4 shadow-sm"
            style="background-color: white"
        >
            <!-- Page Header -->
            <div class="d-flex justify-content-between align-items-center">
                <!-- LEFT SECTION - Product/Service Tabs -->
                <div class="d-inline-flex gap-3">
                    <!-- Products Tab -->
                    <a
                        class="tab-btn"
                        th:href="@{'/products'(filter='products')}"
                        th:classappend="${currentFilter == 'products'} ? ' active' : ''"
                    >
                        Reservedele
                    </a>

                    <!-- Services Tab -->
                    <a
                        class="tab-btn"
                        th:href="@{'/products'(filter='services')}"
                        th:classappend="${currentFilter == 'services'} ? ' active' : ''"
                    >
                        Ydelser
                    </a>
                </div>

                <!-- RIGHT SECTION - Add Product Button (Open Modal Below) -->
                <button
                    type="button"
                    class="btn addProductBtn"
                    data-bs-toggle="modal"
                    data-bs-target="#addProductModal"
                >
                    Tilføj Produkt
                </button>
            </div>

            <!-- === Add Product Modal === -->
            <div
                class="modal fade"
                id="addProductModal"
                tabindex="-1"
                aria-labelledby="addProductModalLabel"
                aria-hidden="true"
            >
                <div class="modal-dialog">
                    <div class="modal-content">
                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="modalTitle">Tilføj Produkter</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>

                        <!-- Modal Body: Input fields for new product info -->
                        <div class="modal-body">
                            <!-- Step 1: Choice Menu -->
                            <div id="choiceMenu" class="text-center py-1">
                                <h4 class="mb-4">Hvad Vil Du Tilføje?</h4>

                                <div class="d-flex justify-content-center align-items-center gap-4 mb-4">
                                    <!-- Add Product Button -->
                                    <button id="addPartBtn" class="choice-btn">
                                        <div class="choice-icon">
                                            <i class="bi bi-box-seam"></i>
                                        </div>
                                        <div class="choice-title">Tilføj Reservedel</div>
                                    </button>

                                    <!-- Add Service Button -->
                                    <button id="addServiceBtn" class="choice-btn">
                                        <div class="choice-icon">
                                            <i class="bi bi-tools"></i>
                                        </div>
                                        <div class="choice-title">Tilføj Ydelse</div>
                                    </button>
                                </div>
                            </div>

                            <!-- Step 2a: Product/Part Form -->
                            <form id="productForm" class="d-none">
                                <div class="mb-3">
                                    <label for="navn-text" class="col-form-label">Navn:</label>
                                    <input type="text" class="form-control" id="navn-text" required />
                                </div>
                                <div class="mb-3">
                                    <label for="EAN-text" class="col-form-label">EAN:</label>
                                    <input type="number" class="form-control" id="EAN-text" required />
                                </div>
                                <div class="mb-3">
                                    <label for="type-text" class="col-form-label">Type</label>
                                    <input type="text" class="form-control" id="type-text" required />
                                </div>
                                <div class="mb-3">
                                    <label for="pris-tal" class="col-form-label">Pris</label>
                                    <input
                                        type="number"
                                        class="form-control"
                                        id="pris-tal"
                                        placeholder="0 - 999999"
                                        required
                                    />
                                </div>
                            </form>

                            <!-- Step 2b: Service Form -->
                            <form id="serviceForm" class="d-none">
                                <div class="mb-3">
                                    <label for="service-navn-text" class="col-form-label">Navn:</label>
                                    <input type="text" class="form-control" id="service-navn-text" required />
                                </div>
                                <div class="mb-3">
                                    <label for="service-price" class="col-form-label">Pris:</label>
                                    <input
                                        type="number"
                                        class="form-control"
                                        id="service-price"
                                        placeholder="0 - 999999"
                                        required
                                    />
                                </div>
                                <div class="mb-3">
                                    <label for="service-duration" class="col-form-label">Varighed (Minutter):</label>
                                    <input
                                        type="number"
                                        class="form-control"
                                        id="service-duration"
                                        placeholder="0 - 25000"
                                        required
                                    />
                                </div>
                            </form>

                            <!-- Modal Footer (Close & Submit Buttons) -->
                            <div class="modal-footer-CUSTOM">
                                <button
                                    type="submit"
                                    class="btn addSomethingBtn d-none mt-3 me-2"
                                    id="submitProductBtn"
                                >
                                    Tilføj Reservedel
                                </button>
                                <button
                                    type="submit"
                                    class="btn addSomethingBtn d-none mt-3 me-2"
                                    id="submitServiceBtn"
                                >
                                    Tilføj Ydelse
                                </button>
                                <button
                                    type="button"
                                    class="btn btn-secondary m-0 mt-3 me-2 d-none"
                                    id="backToChoiceBtn"
                                >
                                    Tilbage
                                </button>
                                <button type="button" class="btn btn-danger m-0 mt-3" data-bs-dismiss="modal">
                                    Luk
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- === Search Bar Section === -->
            <div class="search-bar mt-5-5">
                <nav class="navbar navbar-light">
                    <form class="d-inline-flex" style="width: 100%">
                        <!-- Search Input -->
                        <input class="form-control" type="search" placeholder="Search" aria-label="Search" />
                        <!-- Search Button with Icon -->
                        <button class="btn btn-dark my-2 my-sm-0 ms-2 p-2" type="submit">
                            <span class="material-symbols-outlined" aria-hidden="true">search</span>
                        </button>
                    </form>
                </nav>
            </div>

            <!-- === Product Table === -->
            <!-- Displays a list of products dynamically rendered by Thymeleaf -->
            <div class="mt-5-5">
                <!-- Displays the product table only if the products tab/filter is active -->
                <div th:if="${currentFilter == 'products'}" id="productTableContainer">
                    <table id="productTable" class="table table-striped">
                        <thead>
                            <tr>
                                <th scope="col">ID</th>
                                <th scope="col">Navn</th>
                                <th scope="col">EAN</th>
                                <th scope="col">Type</th>
                                <th scope="col">Pris</th>
                                <th scope="col">Handling</th>
                            </tr>
                        </thead>

                        <tbody>
                            <!-- Thymeleaf loop: Generates one <tr> per product in 'products' list -->
                            <!-- data-id attribute is set dynamically to product.id (used by JS delete logic) -->
                            <tr th:each="product : ${products}" th:attr="data-id=${product.id}">
                                <td
                                    data-field="productNumber"
                                    class="fs-5"
                                    th:text="${product.id}"
                                    th:title="${product.id}"
                                ></td>
                                <td
                                    data-field="name"
                                    class="fs-5"
                                    contenteditable="false"
                                    th:text="${product.name}"
                                    th:title="${product.name}"
                                ></td>
                                <td
                                    data-field="EAN"
                                    class="fs-5"
                                    contenteditable="false"
                                    th:text="${product.EAN}"
                                    th:title="${product.EAN}"
                                ></td>
                                <td
                                    data-field="type"
                                    class="fs-5"
                                    contenteditable="false"
                                    th:text="${product.type}"
                                    th:title="${product.type}"
                                ></td>
                                <td
                                    data-field="price"
                                    class="fs-5"
                                    contenteditable="false"
                                    th:text="${#numbers.formatDecimal(product.price, 2, 'POINT', 2, 'COMMA')} + ' Kr.'"
                                    th:title="${#numbers.formatDecimal(product.price, 2, 'POINT', 2, 'COMMA')} + ' Kr.'"
                                ></td>
                                <td class="fs-5">
                                    <!-- Delete Button (Triggers delete request in JS) -->
                                    <button class="btn btn-outline-danger btn-sm delete-btn" type="button">
                                        <span class="material-symbols-outlined">delete</span>
                                    </button>
                                    <!-- Edit Button (Triggers edit request in JS) -->
                                    <button
                                        class="btn btn-outline-dark btn-sm edit-btn"
                                        type="button"
                                        aria-pressed="false"
                                    >
                                        <span class="material-symbols-outlined edit-btn-icon">edit_square</span>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- === Pagination Bar === -->
                    <!-- Static example navigation (can be made dynamic later) -->
                    <div class="pagination-css align-content-center mt-4">
                        <ul class="pagination justify-content-center Page-Navigation-Bar"></ul>
                    </div>
                </div>
            </div>

            <!-- === Service Table === -->
            <!-- Displays a list of services dynamically rendered by Thymeleaf -->
            <div class="">
                <!-- Displays the service table only if the services tab/filter is active -->
                <div th:if="${currentFilter == 'services'}" id="serviceTableContainer">
                    <table id="serviceTable" class="table table-striped">
                        <thead>
                            <tr>
                                <th scope="col">ID</th>
                                <th scope="col">Navn</th>
                                <th scope="col">Pris</th>
                                <th scope="col">Varighed (Minutter)</th>
                                <th scope="col">Handling</th>
                            </tr>
                        </thead>

                        <tbody>
                            <!-- Thymeleaf loop: Generates one <tr> per service in 'services' list -->
                            <!-- data-id attribute is set dynamically to product.id (used by JS delete logic) -->
                            <tr th:each="service : ${services}" th:attr="data-id=${service.id}">
                                <td data-field="id" class="fs-5" th:text="${service.id}" th:title="${service.id}"></td>
                                <td
                                    data-field="name"
                                    class="fs-5"
                                    contenteditable="false"
                                    th:text="${service.name}"
                                    th:title="${service.name}"
                                ></td>
                                <td
                                    data-field="price"
                                    class="fs-5"
                                    contenteditable="false"
                                    th:text="${#numbers.formatDecimal(service.price, 2, 'POINT', 2, 'COMMA')} + ' Kr.'"
                                    th:title="${#numbers.formatDecimal(service.price, 2, 'POINT', 2, 'COMMA')} + ' Kr.'"
                                ></td>
                                <td
                                    data-field="duration"
                                    class="fs-5"
                                    contenteditable="false"
                                    th:text="${service.duration}"
                                    th:title="${service.duration}"
                                ></td>
                                <td class="fs-5 rowButtons">
                                    <!-- Delete Button (Triggers delete request in JS) -->
                                    <button class="btn btn-outline-danger btn-sm delete-btn" type="button">
                                        <span class="material-symbols-outlined">delete</span>
                                    </button>
                                    <!-- Edit Button (Triggers edit request in JS) -->
                                    <button
                                        class="btn btn-outline-dark btn-sm edit-btn"
                                        type="button"
                                        aria-pressed="false"
                                    >
                                        <span class="material-symbols-outlined edit-btn-icon">edit_square</span>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- === Pagination Bar === -->
                    <!-- Static example navigation (can be made dynamic later) -->
                    <div class="pagination-css align-content-center mt-4">
                        <ul class="pagination justify-content-center Page-Navigation-Bar"></ul>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
